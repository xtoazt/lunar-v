{"version":3,"file":"worker.js","sources":["webpack://@mercuryworkshop/scramjet/./src/scramjet.ts","webpack://@mercuryworkshop/scramjet/./src/shared.ts","webpack://@mercuryworkshop/scramjet/./src/shared/rewriters/js.ts","webpack://@mercuryworkshop/scramjet/./src/worker/error.ts","webpack://@mercuryworkshop/scramjet/./src/worker/fakesw.ts","webpack://@mercuryworkshop/scramjet/./src/worker/fetch.ts","webpack://@mercuryworkshop/scramjet/./rewriter/wasm/out/snippets/wasm-4b0f351a8e6eeb46/inline0.js","webpack://@mercuryworkshop/scramjet/./rewriter/wasm/out/wasm.js","webpack://@mercuryworkshop/scramjet/./src/worker/index.ts"],"sourcesContent":["import { ScramjetFlags } from \"./types\";\n\nif (!(\"$scramjet\" in self)) {\n\t// @ts-expect-error ts stuff\n\tself.$scramjet = {\n\t\tversion: {\n\t\t\tbuild: COMMITHASH,\n\t\t\tversion: VERSION,\n\t\t},\n\t\tcodec: {},\n\t\tflagEnabled,\n\t};\n}\n\nexport const $scramjet = self.$scramjet;\n\nconst nativeFunction = Function;\nexport function loadCodecs() {\n\t$scramjet.codec.encode = nativeFunction(\n\t\t\"url\",\n\t\t$scramjet.config.codec.encode\n\t) as any;\n\t$scramjet.codec.decode = nativeFunction(\n\t\t\"url\",\n\t\t$scramjet.config.codec.decode\n\t) as any;\n}\n\nexport function flagEnabled(flag: keyof ScramjetFlags, url: URL): boolean {\n\tconst value = $scramjet.config.flags[flag];\n\tfor (const regex in $scramjet.config.siteFlags) {\n\t\tconst partialflags = $scramjet.config.siteFlags[regex];\n\t\tif (new RegExp(regex).test(url.href) && flag in partialflags) {\n\t\t\treturn partialflags[flag];\n\t\t}\n\t}\n\n\treturn value;\n}\n","import { $scramjet } from \"./scramjet\";\n\nexport const {\n\tutil: { BareClient, ScramjetHeaders, BareMuxConnection },\n\turl: { rewriteUrl, unrewriteUrl, rewriteBlob, unrewriteBlob },\n\trewrite: {\n\t\trewriteCss,\n\t\tunrewriteCss,\n\t\trewriteHtml,\n\t\tunrewriteHtml,\n\t\trewriteSrcset,\n\t\trewriteJs,\n\t\trewriteHeaders,\n\t\trewriteWorkers,\n\t\thtmlRules,\n\t},\n\tCookieStore,\n} = $scramjet.shared;\n\nexport const config = $scramjet.config;\n","import { URLMeta } from \"./url\";\n\n// i am a cat. i like to be petted. i like to be fed. i like to be\nimport {\n\tinitSync,\n\trewrite_js,\n\trewrite_js_from_arraybuffer,\n\tRewriterOutput,\n} from \"../../../rewriter/wasm/out/wasm.js\";\nimport { $scramjet, flagEnabled } from \"../../scramjet\";\n\nif (self.WASM)\n\tself.REAL_WASM = Uint8Array.from(atob(self.WASM), (c) => c.charCodeAt(0));\n\n// only use in sw\nexport async function asyncInitRewriter() {\n\tconst buf = await fetch($scramjet.config.files.wasm).then((r) =>\n\t\tr.arrayBuffer()\n\t);\n\tself.REAL_WASM = new Uint8Array(buf);\n}\n\nError.stackTraceLimit = 50;\n\nconst decoder = new TextDecoder();\n\nfunction rewriteJsWasm(\n\tinput: string | Uint8Array,\n\tsource: string | null,\n\tmeta: URLMeta,\n\tmodule: boolean\n): { js: string | Uint8Array; map: Uint8Array | null; tag: string } {\n\tinitSync({\n\t\tmodule: new WebAssembly.Module(self.REAL_WASM),\n\t});\n\n\tlet out: RewriterOutput;\n\tconst before = performance.now();\n\ttry {\n\t\tif (typeof input === \"string\") {\n\t\t\tout = rewrite_js(\n\t\t\t\tinput,\n\t\t\t\tmeta.base.href,\n\t\t\t\tsource || \"(unknown)\",\n\t\t\t\tmodule,\n\t\t\t\t$scramjet\n\t\t\t);\n\t\t} else {\n\t\t\tout = rewrite_js_from_arraybuffer(\n\t\t\t\tinput,\n\t\t\t\tmeta.base.href,\n\t\t\t\tsource || \"(unknown)\",\n\t\t\t\tmodule,\n\t\t\t\t$scramjet\n\t\t\t);\n\t\t}\n\t} catch (err) {\n\t\tconst err1 = err as Error;\n\t\tconsole.warn(\"failed rewriting js for\", source, err1.message, input);\n\n\t\treturn { js: input, tag: \"\", map: null };\n\t}\n\tconst after = performance.now();\n\tlet { js, map, scramtag, errors, duration } = out;\n\n\tif (flagEnabled(\"sourcemaps\", meta.base) && !globalThis.clients) {\n\t\tglobalThis[globalThis.$scramjet.config.globals.pushsourcemapfn](\n\t\t\tArray.from(map),\n\t\t\tscramtag\n\t\t);\n\n\t\tmap = null;\n\t}\n\n\tif (flagEnabled(\"rewriterLogs\", meta.base)) {\n\t\tfor (const error of errors) {\n\t\t\tconsole.error(\"oxc parse error\", error);\n\t\t}\n\t}\n\n\tif (flagEnabled(\"rewriterLogs\", meta.base)) {\n\t\tlet timespan: string;\n\t\tif (duration < 1n) {\n\t\t\ttimespan = \"BLAZINGLY FAST\";\n\t\t} else if (duration < 500n) {\n\t\t\ttimespan = \"decent speed\";\n\t\t} else {\n\t\t\ttimespan = \"really slow\";\n\t\t}\n\t\tconst overhead = (after - before - Number(duration)).toFixed(2);\n\t\tconsole.log(\n\t\t\t`oxc rewrite for \"${source || \"(unknown)\"}\" was ${timespan} (${duration}ms; ${overhead}ms overhead)`\n\t\t);\n\t}\n\n\treturn {\n\t\tjs: typeof input === \"string\" ? decoder.decode(js) : js,\n\t\ttag: scramtag,\n\t\tmap,\n\t};\n}\n\n// 1. does not work with modules\n// 2. cannot proxy import()\n// 3. disables \"use strict\" optimizations\n// 4. i think the global state can get clobbered somehow\n//\n// if you can ensure all the preconditions are met this is faster than full rewrites\nfunction rewriteJsNaiive(js: string | ArrayBuffer) {\n\tif (typeof js !== \"string\") {\n\t\tjs = new TextDecoder().decode(js);\n\t}\n\n\treturn `\n\t\twith (${$scramjet.config.globals.wrapfn}(globalThis)) {\n\n\t\t\t${js}\n\n\t\t}\n\t`;\n}\n\nfunction rewriteJsInner(\n\tjs: string | Uint8Array,\n\turl: string | null,\n\tmeta: URLMeta,\n\tmodule = false\n) {\n\tif (flagEnabled(\"naiiveRewriter\", meta.origin)) {\n\t\tconst text = typeof js === \"string\" ? js : new TextDecoder().decode(js);\n\n\t\treturn { js: rewriteJsNaiive(text), tag: \"\", map: null };\n\t}\n\n\treturn rewriteJsWasm(js, url, meta, module);\n}\n\nexport function rewriteJs(\n\tjs: string | Uint8Array,\n\turl: string | null,\n\tmeta: URLMeta,\n\tmodule = false\n) {\n\treturn rewriteJsInner(js, url, meta, module).js;\n}\n\nexport function rewriteJsWithMap(\n\tjs: string | Uint8Array,\n\turl: string | null,\n\tmeta: URLMeta,\n\tmodule = false\n) {\n\treturn rewriteJsInner(js, url, meta, module);\n}\n","import { $scramjet } from \"../scramjet\";\n\nexport function errorTemplate(trace: string, fetchedURL: string) {\n\t// turn script into a data URI so we don\"t have to escape any HTML values\n\tconst script = `\n                errorTrace.value = ${JSON.stringify(trace)};\n                fetchedURL.textContent = ${JSON.stringify(fetchedURL)};\n                for (const node of document.querySelectorAll(\"#hostname\")) node.textContent = ${JSON.stringify(location.hostname)};\n                reload.addEventListener(\"click\", () => location.reload());\n                version.textContent = ${JSON.stringify($scramjet.version.version)};\n                build.textContent = ${JSON.stringify($scramjet.version.build)};\n                \n                document.getElementById('copy-button').addEventListener('click', async () => {\n                    const text = document.getElementById('errorTrace').value;\n                    await navigator.clipboard.writeText(text);\n                    const btn = document.getElementById('copy-button');\n                    btn.textContent = 'Copied!';\n                    setTimeout(() => btn.textContent = 'Copy', 2000);\n                });\n        `;\n\n\treturn `<!DOCTYPE html>\n            <html>\n                <head>\n                    <meta charset=\"utf-8\" />\n                    <title>Scramjet</title>\n                    <style>\n                    :root {\n                        --deep: #080602;\n                        --shallow: #181412;\n                        --beach: #f1e8e1;\n                        --shore: #b1a8a1;\n                        --accent: #ffa938;\n                        --font-sans: -apple-system, system-ui, BlinkMacSystemFont, sans-serif;\n                        --font-monospace: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, \"Liberation Mono\", \"Courier New\", monospace;\n                    }\n\n                    *:not(div,p,span,ul,li,i,span) {\n                        background-color: var(--deep);\n                        color: var(--beach);\n                        font-family: var(--font-sans);\n                    }\n\n                    textarea,\n                    button {\n                        background-color: var(--shallow);\n                        border-radius: 0.6em;\n                        padding: 0.6em;\n                        border: none;\n                        appearance: none;\n                        font-family: var(--font-sans);\n                        color: var(--beach);\n                    }\n\n                    button.primary {\n                        background-color: var(--accent);\n                        color: var(--deep);\n                        font-weight: bold;\n                    }\n\n                    textarea {\n                        resize: none;\n                        height: 20em;\n                        text-align: left;\n                        font-family: var(--font-monospace);\n                    }\n\n                    body {\n                        width: 100vw;\n                        height: 100vh;\n                        justify-content: center;\n                        align-items: center;\n                    }\n\n                    body,\n                    html,\n                    #inner {\n                        display: flex;\n                        align-items: center;\n                        flex-direction: column;\n                        gap: 0.5em;\n                        overflow: hidden;\n                    }\n\n                    #inner {\n                        z-index: 100;\n                    }\n\n                    #cover {\n                        position: absolute;\n                        width: 100%;\n                        height: 100%;\n                        background-color: color-mix(in srgb, var(--deep) 70%, transparent);\n                        z-index: 99;\n                    }\n\n                    #info {\n                        display: flex;\n                        flex-direction: row;\n                        align-items: flex-start;\n                        gap: 1em;\n                    }\n\n                    #version-wrapper {\n                        width: auto;\n                        text-align: right;\n                        position: absolute;\n                        top: 0.5rem;\n                        right: 0.5rem;\n                        font-size: 0.8rem;\n                        color: var(--shore)!important;\n                        i {\n                            background-color: color-mix(in srgb, var(--deep), transparent 50%);\n                            border-radius: 9999px;\n                            padding: 0.2em 0.5em;\n                        }\n                        z-index: 101;\n                    }\n\n                    #errorTrace-wrapper {\n                        position: relative;\n                        width: fit-content;\n                    }\n\n                    #copy-button {\n                        position: absolute;\n                        top: 0.5em;\n                        right: 0.5em;\n                        padding: 0.23em;\n                        cursor: pointer;\n                        opacity: 0;\n                        transition: opacity 0.4s;\n                        font-size: 0.9em;\n                    }\n\n                    #errorTrace-wrapper:hover #copy-button {\n                        opacity: 1;\n                    }\n                    </style>\n                </head>\n                <body>\n                    <div id=\"cover\"></div>\n                    <div id=\"inner\">\n                        <h1 id=\"errorTitle\">Uh oh!</h1>\n                        <p>There was an error loading <b id=\"fetchedURL\"></b></p>\n                        <!-- <p id=\"errorMessage\">Internal Server Error</p> -->\n\n                        <div id=\"info\">\n                            <div id=\"errorTrace-wrapper\">\n                                <textarea id=\"errorTrace\" cols=\"40\" rows=\"10\" readonly></textarea>\n                                <button id=\"copy-button\" class=\"primary\">Copy</button>\n                            </div>\n                            <div id=\"troubleshooting\">\n                                <p>Try:</p>\n                                <ul>\n                                    <li>Checking your internet connection</li>\n                                    <li>Verifying you entered the correct address</li>\n                                    <li>Clearing the site data</li>\n                                    <li>Contacting <b id=\"hostname\"></b>'s administrator</li>\n                                    <li>Verify the server isn't censored</li>\n                                </ul>\n                                <p>If you're the administrator of <b id=\"hostname\"></b>, try:</p>\n                                    <ul>\n                                    <li>Restarting your server</li>\n                                    <li>Updating Scramjet</li>\n                                    <li>Troubleshooting the error on the <a href=\"https://github.com/MercuryWorkshop/scramjet\" target=\"_blank\">GitHub repository</a></li>\n                                </ul>\n                            </div>\n                        </div>\n                        <br>\n                        <button id=\"reload\" class=\"primary\">Reload</button>\n                    </div>\n                    <p id=\"version-wrapper\"><i>Scramjet v<span id=\"version\"></span> (build <span id=\"build\"></span>)</i></p>\n                    <script src=\"${\"data:application/javascript,\" + encodeURIComponent(script)}\"></script>\n                </body>\n            </html>\n        `;\n}\n\nexport function renderError(err: unknown, fetchedURL: string) {\n\tconst headers = {\n\t\t\"content-type\": \"text/html\",\n\t};\n\tif (crossOriginIsolated) {\n\t\theaders[\"Cross-Origin-Embedder-Policy\"] = \"require-corp\";\n\t}\n\n\treturn new Response(errorTemplate(String(err), fetchedURL), {\n\t\tstatus: 500,\n\t\theaders: headers,\n\t});\n}\n","import { type MessageW2R, type MessageR2W } from \"../client/swruntime\";\n\nexport class FakeServiceWorker {\n\tsyncToken = 0;\n\tpromises: Record<number, (val?: MessageR2W) => void> = {};\n\tmessageChannel = new MessageChannel();\n\tconnected = false;\n\n\tconstructor(\n\t\tpublic handle: MessagePort,\n\t\tpublic origin: string\n\t) {\n\t\tthis.messageChannel.port1.addEventListener(\"message\", (event) => {\n\t\t\tif (\"scramjet$type\" in event.data) {\n\t\t\t\tif (event.data.scramjet$type === \"init\") {\n\t\t\t\t\tthis.connected = true;\n\t\t\t\t} else {\n\t\t\t\t\tthis.handleMessage(event.data);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tthis.messageChannel.port1.start();\n\n\t\tthis.handle.postMessage(\n\t\t\t{\n\t\t\t\tscramjet$type: \"init\",\n\t\t\t\tscramjet$port: this.messageChannel.port2,\n\t\t\t},\n\t\t\t[this.messageChannel.port2]\n\t\t);\n\t}\n\n\thandleMessage(data: MessageR2W) {\n\t\tconst cb = this.promises[data.scramjet$token];\n\t\tif (cb) {\n\t\t\tcb(data);\n\t\t\tdelete this.promises[data.scramjet$token];\n\t\t}\n\t}\n\n\tasync fetch(request: Request): Promise<Response | false> {\n\t\tconst token = this.syncToken++;\n\n\t\tconst message: MessageW2R = {\n\t\t\tscramjet$type: \"fetch\",\n\t\t\tscramjet$token: token,\n\t\t\tscramjet$request: {\n\t\t\t\turl: request.url,\n\t\t\t\tbody: request.body,\n\t\t\t\theaders: Array.from(request.headers.entries()),\n\t\t\t\tmethod: request.method,\n\t\t\t\tmode: request.mode,\n\t\t\t\tdestinitation: request.destination,\n\t\t\t},\n\t\t};\n\n\t\tconst transfer = request.body ? [request.body] : [];\n\n\t\tthis.handle.postMessage(message, transfer);\n\n\t\tconst { scramjet$response: r } = (await new Promise((resolve) => {\n\t\t\tthis.promises[token] = resolve;\n\t\t})) as MessageR2W;\n\n\t\tif (!r) return false;\n\n\t\treturn new Response(r.body, {\n\t\t\theaders: r.headers,\n\t\t\tstatus: r.status,\n\t\t\tstatusText: r.statusText,\n\t\t});\n\t}\n}\n","import { BareResponseFetch } from \"@mercuryworkshop/bare-mux\";\nimport { ScramjetServiceWorker } from \".\";\nimport { renderError } from \"./error\";\nimport { FakeServiceWorker } from \"./fakesw\";\nimport { CookieStore } from \"../shared/cookie\";\nimport {\n\tScramjetHeaders,\n\tunrewriteUrl,\n\trewriteCss,\n\trewriteHeaders,\n\trewriteHtml,\n\trewriteWorkers,\n\tunrewriteBlob,\n} from \"../shared\";\n\nimport type { URLMeta } from \"../shared/rewriters/url\";\nimport { $scramjet, flagEnabled } from \"../scramjet\";\nimport { rewriteJsWithMap } from \"../shared/rewriters/js\";\n\nfunction newmeta(url: URL): URLMeta {\n\treturn {\n\t\torigin: url,\n\t\tbase: url,\n\t};\n}\n\nexport async function handleFetch(\n\tthis: ScramjetServiceWorker,\n\trequest: Request,\n\tclient: Client | null\n) {\n\ttry {\n\t\tconst requesturl = new URL(request.url);\n\t\tlet workertype = \"\";\n\t\tif (requesturl.searchParams.has(\"type\")) {\n\t\t\tworkertype = requesturl.searchParams.get(\"type\") as string;\n\t\t\trequesturl.searchParams.delete(\"type\");\n\t\t}\n\t\tif (requesturl.searchParams.has(\"dest\")) {\n\t\t\trequesturl.searchParams.delete(\"dest\");\n\t\t}\n\n\t\tif (requesturl.pathname === this.config.files.wasm) {\n\t\t\treturn fetch(this.config.files.wasm).then(async (x) => {\n\t\t\t\tconst buf = await x.arrayBuffer();\n\t\t\t\tconst b64 = btoa(\n\t\t\t\t\tnew Uint8Array(buf)\n\t\t\t\t\t\t.reduce(\n\t\t\t\t\t\t\t(data, byte) => (data.push(String.fromCharCode(byte)), data),\n\t\t\t\t\t\t\t[]\n\t\t\t\t\t\t)\n\t\t\t\t\t\t.join(\"\")\n\t\t\t\t);\n\n\t\t\t\tlet payload = \"\";\n\t\t\t\tpayload +=\n\t\t\t\t\t\"if ('document' in self && document.currentScript) { document.currentScript.remove(); }\\n\";\n\t\t\t\tpayload += `self.WASM = '${b64}';`;\n\n\t\t\t\treturn new Response(payload, {\n\t\t\t\t\theaders: { \"content-type\": \"text/javascript\" },\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\tif (\n\t\t\trequesturl.pathname.startsWith(this.config.prefix + \"blob:\") ||\n\t\t\trequesturl.pathname.startsWith(this.config.prefix + \"data:\")\n\t\t) {\n\t\t\tlet dataurl = requesturl.pathname.substring(this.config.prefix.length);\n\t\t\tif (dataurl.startsWith(\"blob:\")) {\n\t\t\t\tdataurl = unrewriteBlob(dataurl);\n\t\t\t}\n\n\t\t\tconst response: Partial<BareResponseFetch> = await fetch(dataurl, {});\n\t\t\tconst url = dataurl.startsWith(\"blob:\") ? dataurl : \"(data url)\";\n\t\t\tresponse.finalURL = url;\n\t\t\tlet body: BodyType;\n\n\t\t\tif (response.body) {\n\t\t\t\tbody = await rewriteBody(\n\t\t\t\t\tresponse as BareResponseFetch,\n\t\t\t\t\tclient\n\t\t\t\t\t\t? {\n\t\t\t\t\t\t\t\tbase: new URL(new URL(client.url).origin),\n\t\t\t\t\t\t\t\torigin: new URL(new URL(client.url).origin),\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t: newmeta(new URL(unrewriteUrl(request.referrer))),\n\t\t\t\t\trequest.destination,\n\t\t\t\t\tworkertype,\n\t\t\t\t\tthis.cookieStore\n\t\t\t\t);\n\t\t\t}\n\t\t\tconst headers = Object.fromEntries(response.headers.entries());\n\n\t\t\tif (crossOriginIsolated) {\n\t\t\t\theaders[\"Cross-Origin-Opener-Policy\"] = \"same-origin\";\n\t\t\t\theaders[\"Cross-Origin-Embedder-Policy\"] = \"require-corp\";\n\t\t\t}\n\n\t\t\treturn new Response(body, {\n\t\t\t\tstatus: response.status,\n\t\t\t\tstatusText: response.statusText,\n\t\t\t\theaders: headers,\n\t\t\t});\n\t\t}\n\n\t\tconst url = new URL(unrewriteUrl(requesturl));\n\n\t\tconst activeWorker: FakeServiceWorker | null = this.serviceWorkers.find(\n\t\t\t(w) => w.origin === url.origin\n\t\t);\n\n\t\tif (\n\t\t\tactiveWorker &&\n\t\t\tactiveWorker.connected &&\n\t\t\trequesturl.searchParams.get(\"from\") !== \"swruntime\"\n\t\t) {\n\t\t\t// TODO: check scope\n\t\t\tconst r = await activeWorker.fetch(request);\n\t\t\tif (r) return r;\n\t\t}\n\t\tif (url.origin == new URL(request.url).origin) {\n\t\t\tthrow new Error(\n\t\t\t\t\"attempted to fetch from same origin - this means the site has obtained a reference to the real origin, aborting\"\n\t\t\t);\n\t\t}\n\n\t\tconst headers = new ScramjetHeaders();\n\t\tfor (const [key, value] of request.headers.entries()) {\n\t\t\theaders.set(key, value);\n\t\t}\n\n\t\tif (\n\t\t\tclient &&\n\t\t\tnew URL(client.url).pathname.startsWith($scramjet.config.prefix)\n\t\t) {\n\t\t\t// TODO: i was against cors emulation but we might actually break stuff if we send full origin/referrer always\n\t\t\tconst clientURL = new URL(unrewriteUrl(client.url));\n\t\t\tif (clientURL.toString().includes(\"youtube.com\")) {\n\t\t\t\t// console.log(headers);\n\t\t\t} else {\n\t\t\t\theaders.set(\"Referer\", clientURL.toString());\n\t\t\t\theaders.set(\n\t\t\t\t\t\"Origin\",\n\t\t\t\t\tclientURL.origin ? `${clientURL.protocol}//${clientURL.host}` : \"null\"\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\tconst cookies = this.cookieStore.getCookies(url, false);\n\n\t\tif (cookies.length) {\n\t\t\theaders.set(\"Cookie\", cookies);\n\t\t}\n\n\t\theaders.set(\"Sec-Fetch-Dest\", request.destination);\n\t\t//TODO: Emulate this later (like really)\n\t\theaders.set(\"Sec-Fetch-Site\", \"same-origin\");\n\t\theaders.set(\n\t\t\t\"Sec-Fetch-Mode\",\n\t\t\trequest.mode === \"cors\" ? request.mode : \"same-origin\"\n\t\t);\n\n\t\tconst ev = new ScramjetRequestEvent(\n\t\t\turl,\n\t\t\theaders.headers,\n\t\t\trequest.body,\n\t\t\trequest.method,\n\t\t\trequest.destination,\n\t\t\tclient\n\t\t);\n\t\tthis.dispatchEvent(ev);\n\n\t\tconst response: BareResponseFetch =\n\t\t\tev.response ||\n\t\t\t(await this.client.fetch(ev.url, {\n\t\t\t\tmethod: ev.method,\n\t\t\t\tbody: ev.body,\n\t\t\t\theaders: ev.requestHeaders,\n\t\t\t\tcredentials: \"omit\",\n\t\t\t\tmode: request.mode === \"cors\" ? request.mode : \"same-origin\",\n\t\t\t\tcache: request.cache,\n\t\t\t\tredirect: \"manual\",\n\t\t\t\t//@ts-ignore why the fuck is this not typed mircosoft\n\t\t\t\tduplex: \"half\",\n\t\t\t}));\n\n\t\treturn await handleResponse(\n\t\t\turl,\n\t\t\tworkertype,\n\t\t\trequest.destination,\n\t\t\tresponse,\n\t\t\tthis.cookieStore,\n\t\t\tclient,\n\t\t\tthis\n\t\t);\n\t} catch (err) {\n\t\tconst errorDetails = {\n\t\t\tmessage: err.message,\n\t\t\turl: request.url,\n\t\t\tdestination: request.destination,\n\t\t\ttimestamp: new Date().toISOString(),\n\t\t};\n\t\tif (err.stack) {\n\t\t\terrorDetails[\"stack\"] = err.stack;\n\t\t}\n\n\t\tconsole.error(\"ERROR FROM SERVICE WORKER FETCH: \", errorDetails);\n\n\t\tif (![\"document\", \"iframe\"].includes(request.destination))\n\t\t\treturn new Response(undefined, { status: 500 });\n\n\t\tconst formattedError = Object.entries(errorDetails)\n\t\t\t.map(\n\t\t\t\t([key, value]) =>\n\t\t\t\t\t`${key.charAt(0).toUpperCase() + key.slice(1)}: ${value}`\n\t\t\t)\n\t\t\t.join(\"\\n\\n\");\n\n\t\treturn renderError(formattedError, unrewriteUrl(request.url));\n\t}\n}\n\nasync function handleResponse(\n\turl: URL,\n\tworkertype: string,\n\tdestination: RequestDestination,\n\tresponse: BareResponseFetch,\n\tcookieStore: CookieStore,\n\tclient: Client,\n\tswtarget: ScramjetServiceWorker\n): Promise<Response> {\n\tlet responseBody: BodyType;\n\tconst responseHeaders = rewriteHeaders(response.rawHeaders, newmeta(url));\n\n\tconst maybeHeaders = responseHeaders[\"set-cookie\"] || [];\n\tfor (const cookie in maybeHeaders) {\n\t\tif (client) {\n\t\t\tconst promise = swtarget.dispatch(client, {\n\t\t\t\tscramjet$type: \"cookie\",\n\t\t\t\tcookie,\n\t\t\t\turl: url.href,\n\t\t\t});\n\t\t\tif (destination !== \"document\" && destination !== \"iframe\") {\n\t\t\t\tawait promise;\n\t\t\t}\n\t\t}\n\t}\n\n\tawait cookieStore.setCookies(\n\t\tmaybeHeaders instanceof Array ? maybeHeaders : [maybeHeaders],\n\t\turl\n\t);\n\n\tfor (const header in responseHeaders) {\n\t\t// flatten everything past here\n\t\tif (Array.isArray(responseHeaders[header]))\n\t\t\tresponseHeaders[header] = responseHeaders[header][0];\n\t}\n\n\tif (response.body) {\n\t\tresponseBody = await rewriteBody(\n\t\t\tresponse,\n\t\t\tnewmeta(url),\n\t\t\tdestination,\n\t\t\tworkertype,\n\t\t\tcookieStore\n\t\t);\n\t}\n\n\t// downloads\n\tif ([\"document\", \"iframe\"].includes(destination)) {\n\t\tconst header = responseHeaders[\"content-disposition\"];\n\n\t\t// validate header and test for filename\n\t\tif (!/\\s*?((inline|attachment);\\s*?)filename=/i.test(header)) {\n\t\t\t// if filename= wasn\"t specified then maybe the remote specified to download this as an attachment?\n\t\t\t// if it\"s invalid then we can still possibly test for the attachment/inline type\n\t\t\tconst type = /^\\s*?attachment/i.test(header) ? \"attachment\" : \"inline\";\n\n\t\t\t// set the filename\n\t\t\tconst [filename] = new URL(response.finalURL).pathname\n\t\t\t\t.split(\"/\")\n\t\t\t\t.slice(-1);\n\n\t\t\tresponseHeaders[\"content-disposition\"] =\n\t\t\t\t`${type}; filename=${JSON.stringify(filename)}`;\n\t\t}\n\t}\n\tif (responseHeaders[\"accept\"] === \"text/event-stream\") {\n\t\tresponseHeaders[\"content-type\"] = \"text/event-stream\";\n\t}\n\n\t// scramjet runtime can use features that permissions-policy blocks\n\tdelete responseHeaders[\"permissions-policy\"];\n\n\tif (\n\t\tcrossOriginIsolated &&\n\t\t[\n\t\t\t\"document\",\n\t\t\t\"iframe\",\n\t\t\t\"worker\",\n\t\t\t\"sharedworker\",\n\t\t\t\"style\",\n\t\t\t\"script\",\n\t\t].includes(destination)\n\t) {\n\t\tresponseHeaders[\"Cross-Origin-Embedder-Policy\"] = \"require-corp\";\n\t\tresponseHeaders[\"Cross-Origin-Opener-Policy\"] = \"same-origin\";\n\t}\n\n\tconst ev = new ScramjetHandleResponseEvent(\n\t\tresponseBody,\n\t\tresponseHeaders,\n\t\tresponse.status,\n\t\tresponse.statusText,\n\t\tdestination,\n\t\turl,\n\t\tresponse,\n\t\tclient\n\t);\n\tswtarget.dispatchEvent(ev);\n\n\treturn new Response(ev.responseBody, {\n\t\theaders: ev.responseHeaders as HeadersInit,\n\t\tstatus: ev.status,\n\t\tstatusText: ev.statusText,\n\t});\n}\n\nasync function rewriteBody(\n\tresponse: BareResponseFetch,\n\tmeta: URLMeta,\n\tdestination: RequestDestination,\n\tworkertype: string,\n\tcookieStore: CookieStore\n): Promise<BodyType> {\n\tswitch (destination) {\n\t\tcase \"iframe\":\n\t\tcase \"document\":\n\t\t\tif (response.headers.get(\"content-type\")?.startsWith(\"text/html\")) {\n\t\t\t\t// note from percs: i think this has the potential to be slow asf, but for right now its fine (we should probably look for a better solution)\n\t\t\t\t// another note from percs: regex seems to be broken, gonna comment this out\n\t\t\t\t/*\n\t\t\t\tconst buf = await response.arrayBuffer();\n\t\t\t\tconst decode = new TextDecoder(\"utf-8\").decode(buf);\n\t\t\t\tconst charsetHeader = response.headers.get(\"content-type\");\n\t\t\t\tconst charset =\n\t\t\t\t\tcharsetHeader?.split(\"charset=\")[1] ||\n\t\t\t\t\tdecode.match(/charset=([^\"]+)/)?.[1] ||\n\t\t\t\t\t\"utf-8\";\n\t\t\t\tconst htmlContent = charset\n\t\t\t\t\t? new TextDecoder(charset).decode(buf)\n\t\t\t\t\t: decode;\n\t\t\t\t*/\n\t\t\t\treturn rewriteHtml(await response.text(), cookieStore, meta, true);\n\t\t\t} else {\n\t\t\t\treturn response.body;\n\t\t\t}\n\t\tcase \"script\": {\n\t\t\tlet { js, tag, map } = rewriteJsWithMap(\n\t\t\t\tnew Uint8Array(await response.arrayBuffer()),\n\t\t\t\tresponse.finalURL,\n\t\t\t\tmeta,\n\t\t\t\tworkertype === \"module\"\n\t\t\t);\n\t\t\tif (flagEnabled(\"sourcemaps\", meta.base) && map) {\n\t\t\t\tif (js instanceof Uint8Array) {\n\t\t\t\t\tjs = new TextDecoder().decode(js);\n\t\t\t\t}\n\t\t\t\tconst sourcemapfn = `${globalThis.$scramjet.config.globals.pushsourcemapfn}([${map.join(\",\")}], \"${tag}\");`;\n\t\t\t\tconst strictMode = /^\\s*(['\"])use strict\\1;?/;\n\t\t\t\tif (strictMode.test(js)) {\n\t\t\t\t\tjs = js.replace(strictMode, `$&\\n${sourcemapfn}`);\n\t\t\t\t} else {\n\t\t\t\t\tjs = `${sourcemapfn}\\n${js}`;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn js as unknown as ArrayBuffer;\n\t\t}\n\t\tcase \"style\":\n\t\t\treturn rewriteCss(await response.text(), meta);\n\t\tcase \"sharedworker\":\n\t\tcase \"worker\":\n\t\t\treturn rewriteWorkers(\n\t\t\t\tnew Uint8Array(await response.arrayBuffer()),\n\t\t\t\tworkertype,\n\t\t\t\tresponse.finalURL,\n\t\t\t\tmeta\n\t\t\t);\n\t\tdefault:\n\t\t\treturn response.body;\n\t}\n}\n\ntype BodyType = string | ArrayBuffer | Blob | ReadableStream<any>;\n\nexport class ScramjetHandleResponseEvent extends Event {\n\tconstructor(\n\t\tpublic responseBody: BodyType,\n\t\tpublic responseHeaders: Record<string, string>,\n\t\tpublic status: number,\n\t\tpublic statusText: string,\n\t\tpublic destination: string,\n\t\tpublic url: URL,\n\t\tpublic rawResponse: BareResponseFetch,\n\t\tpublic client: Client\n\t) {\n\t\tsuper(\"handleResponse\");\n\t}\n}\n\nexport class ScramjetRequestEvent extends Event {\n\tconstructor(\n\t\tpublic url: URL,\n\t\tpublic requestHeaders: Record<string, string>,\n\t\tpublic body: BodyType,\n\t\tpublic method: string,\n\t\tpublic destination: string,\n\t\tpublic client: Client\n\t) {\n\t\tsuper(\"request\");\n\t}\n\tpublic response?: BareResponseFetch;\n}\n","\n// slightly modified https://github.com/ungap/random-uuid/blob/main/index.js\nexport function scramtag() {\n    return (\"\"+1e10).replace(/[018]/g,\n      c => (c ^ crypto.getRandomValues(new Uint8Array(1))[0] & 15 >> c / 4).toString(16)\n    );\n}\n","import { scramtag } from './snippets/wasm-4b0f351a8e6eeb46/inline0.js';\n\nlet wasm;\n\nfunction addToExternrefTable0(obj) {\n    const idx = wasm.__externref_table_alloc();\n    wasm.__wbindgen_export_2.set(idx, obj);\n    return idx;\n}\n\nfunction handleError(f, args) {\n    try {\n        return f.apply(this, args);\n    } catch (e) {\n        const idx = addToExternrefTable0(e);\n        wasm.__wbindgen_exn_store(idx);\n    }\n}\n\nconst cachedTextDecoder = (typeof TextDecoder !== 'undefined' ? new TextDecoder('utf-8', { ignoreBOM: true, fatal: true }) : { decode: () => { throw Error('TextDecoder not available') } } );\n\nif (typeof TextDecoder !== 'undefined') { cachedTextDecoder.decode(); };\n\nlet cachedUint8ArrayMemory0 = null;\n\nfunction getUint8ArrayMemory0() {\n    if (cachedUint8ArrayMemory0 === null || cachedUint8ArrayMemory0.buffer !== wasm.memory.buffer) {\n        cachedUint8ArrayMemory0 = new Uint8Array(wasm.memory.buffer);\n    }\n    return cachedUint8ArrayMemory0;\n}\n\nfunction getStringFromWasm0(ptr, len) {\n    ptr = ptr >>> 0;\n    return cachedTextDecoder.decode(getUint8ArrayMemory0().slice(ptr, ptr + len));\n}\n\nlet WASM_VECTOR_LEN = 0;\n\nconst cachedTextEncoder = (typeof TextEncoder !== 'undefined' ? new TextEncoder('utf-8') : { encode: () => { throw Error('TextEncoder not available') } } );\n\nconst encodeString = function (arg, view) {\n    const buf = cachedTextEncoder.encode(arg);\n    view.set(buf);\n    return {\n        read: arg.length,\n        written: buf.length\n    };\n};\n\nfunction passStringToWasm0(arg, malloc, realloc) {\n\n    if (realloc === undefined) {\n        const buf = cachedTextEncoder.encode(arg);\n        const ptr = malloc(buf.length, 1) >>> 0;\n        getUint8ArrayMemory0().subarray(ptr, ptr + buf.length).set(buf);\n        WASM_VECTOR_LEN = buf.length;\n        return ptr;\n    }\n\n    let len = arg.length;\n    let ptr = malloc(len, 1) >>> 0;\n\n    const mem = getUint8ArrayMemory0();\n\n    let offset = 0;\n\n    for (; offset < len; offset++) {\n        const code = arg.charCodeAt(offset);\n        if (code > 0x7F) break;\n        mem[ptr + offset] = code;\n    }\n\n    if (offset !== len) {\n        if (offset !== 0) {\n            arg = arg.slice(offset);\n        }\n        ptr = realloc(ptr, len, len = offset + arg.length * 3, 1) >>> 0;\n        const view = getUint8ArrayMemory0().subarray(ptr + offset, ptr + len);\n        const ret = encodeString(arg, view);\n\n        offset += ret.written;\n        ptr = realloc(ptr, len, offset, 1) >>> 0;\n    }\n\n    WASM_VECTOR_LEN = offset;\n    return ptr;\n}\n\nlet cachedDataViewMemory0 = null;\n\nfunction getDataViewMemory0() {\n    if (cachedDataViewMemory0 === null || cachedDataViewMemory0.buffer !== wasm.memory.buffer) {\n        cachedDataViewMemory0 = new DataView(wasm.memory.buffer);\n    }\n    return cachedDataViewMemory0;\n}\n\nfunction isLikeNone(x) {\n    return x === undefined || x === null;\n}\n\nfunction takeFromExternrefTable0(idx) {\n    const value = wasm.__wbindgen_export_2.get(idx);\n    wasm.__externref_table_dealloc(idx);\n    return value;\n}\n/**\n * @param {string} js\n * @param {string} url\n * @param {string} script_url\n * @param {boolean} module\n * @param {object} scramjet\n * @returns {RewriterOutput}\n */\nexport function rewrite_js(js, url, script_url, module, scramjet) {\n    const ptr0 = passStringToWasm0(js, wasm.__wbindgen_malloc, wasm.__wbindgen_realloc);\n    const len0 = WASM_VECTOR_LEN;\n    const ptr1 = passStringToWasm0(url, wasm.__wbindgen_malloc, wasm.__wbindgen_realloc);\n    const len1 = WASM_VECTOR_LEN;\n    const ptr2 = passStringToWasm0(script_url, wasm.__wbindgen_malloc, wasm.__wbindgen_realloc);\n    const len2 = WASM_VECTOR_LEN;\n    const ret = wasm.rewrite_js(ptr0, len0, ptr1, len1, ptr2, len2, module, scramjet);\n    if (ret[2]) {\n        throw takeFromExternrefTable0(ret[1]);\n    }\n    return takeFromExternrefTable0(ret[0]);\n}\n\nfunction passArray8ToWasm0(arg, malloc) {\n    const ptr = malloc(arg.length * 1, 1) >>> 0;\n    getUint8ArrayMemory0().set(arg, ptr / 1);\n    WASM_VECTOR_LEN = arg.length;\n    return ptr;\n}\n/**\n * @param {Uint8Array} js\n * @param {string} url\n * @param {string} script_url\n * @param {boolean} module\n * @param {object} scramjet\n * @returns {RewriterOutput}\n */\nexport function rewrite_js_from_arraybuffer(js, url, script_url, module, scramjet) {\n    const ptr0 = passArray8ToWasm0(js, wasm.__wbindgen_malloc);\n    const len0 = WASM_VECTOR_LEN;\n    const ptr1 = passStringToWasm0(url, wasm.__wbindgen_malloc, wasm.__wbindgen_realloc);\n    const len1 = WASM_VECTOR_LEN;\n    const ptr2 = passStringToWasm0(script_url, wasm.__wbindgen_malloc, wasm.__wbindgen_realloc);\n    const len2 = WASM_VECTOR_LEN;\n    const ret = wasm.rewrite_js_from_arraybuffer(ptr0, len0, ptr1, len1, ptr2, len2, module, scramjet);\n    if (ret[2]) {\n        throw takeFromExternrefTable0(ret[1]);\n    }\n    return takeFromExternrefTable0(ret[0]);\n}\n\nasync function __wbg_load(module, imports) {\n    if (typeof Response === 'function' && module instanceof Response) {\n        if (typeof WebAssembly.instantiateStreaming === 'function') {\n            try {\n                return await WebAssembly.instantiateStreaming(module, imports);\n\n            } catch (e) {\n                if (module.headers.get('Content-Type') != 'application/wasm') {\n                    console.warn(\"`WebAssembly.instantiateStreaming` failed because your server does not serve Wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\\n\", e);\n\n                } else {\n                    throw e;\n                }\n            }\n        }\n\n        const bytes = await module.arrayBuffer();\n        return await WebAssembly.instantiate(bytes, imports);\n\n    } else {\n        const instance = await WebAssembly.instantiate(module, imports);\n\n        if (instance instanceof WebAssembly.Instance) {\n            return { instance, module };\n\n        } else {\n            return instance;\n        }\n    }\n}\n\nfunction __wbg_get_imports() {\n    const imports = {};\n    imports.wbg = {};\n    imports.wbg.__wbg_buffer_609cc3eee51ed158 = function(arg0) {\n        const ret = arg0.buffer;\n        return ret;\n    };\n    imports.wbg.__wbg_call_672a4d21634d4a24 = function() { return handleError(function (arg0, arg1) {\n        const ret = arg0.call(arg1);\n        return ret;\n    }, arguments) };\n    imports.wbg.__wbg_call_7cccdd69e0791ae2 = function() { return handleError(function (arg0, arg1, arg2) {\n        const ret = arg0.call(arg1, arg2);\n        return ret;\n    }, arguments) };\n    imports.wbg.__wbg_call_833bed5770ea2041 = function() { return handleError(function (arg0, arg1, arg2, arg3) {\n        const ret = arg0.call(arg1, arg2, arg3);\n        return ret;\n    }, arguments) };\n    imports.wbg.__wbg_get_67b2ba62fc30de12 = function() { return handleError(function (arg0, arg1) {\n        const ret = Reflect.get(arg0, arg1);\n        return ret;\n    }, arguments) };\n    imports.wbg.__wbg_new_405e22f390576ce2 = function() {\n        const ret = new Object();\n        return ret;\n    };\n    imports.wbg.__wbg_new_78feb108b6472713 = function() {\n        const ret = new Array();\n        return ret;\n    };\n    imports.wbg.__wbg_new_9ffbe0a71eff35e3 = function() { return handleError(function (arg0, arg1) {\n        const ret = new URL(getStringFromWasm0(arg0, arg1));\n        return ret;\n    }, arguments) };\n    imports.wbg.__wbg_new_a12002a7f91c75be = function(arg0) {\n        const ret = new Uint8Array(arg0);\n        return ret;\n    };\n    imports.wbg.__wbg_newnoargs_105ed471475aaf50 = function(arg0, arg1) {\n        const ret = new Function(getStringFromWasm0(arg0, arg1));\n        return ret;\n    };\n    imports.wbg.__wbg_newwithbase_161c299e7a34e2eb = function() { return handleError(function (arg0, arg1, arg2, arg3) {\n        const ret = new URL(getStringFromWasm0(arg0, arg1), getStringFromWasm0(arg2, arg3));\n        return ret;\n    }, arguments) };\n    imports.wbg.__wbg_newwithbyteoffsetandlength_d97e637ebe145a9a = function(arg0, arg1, arg2) {\n        const ret = new Uint8Array(arg0, arg1 >>> 0, arg2 >>> 0);\n        return ret;\n    };\n    imports.wbg.__wbg_now_d18023d54d4e5500 = function(arg0) {\n        const ret = arg0.now();\n        return ret;\n    };\n    imports.wbg.__wbg_scramtag_3a255d78b157986d = function(arg0) {\n        const ret = scramtag();\n        const ptr1 = passStringToWasm0(ret, wasm.__wbindgen_malloc, wasm.__wbindgen_realloc);\n        const len1 = WASM_VECTOR_LEN;\n        getDataViewMemory0().setInt32(arg0 + 4 * 1, len1, true);\n        getDataViewMemory0().setInt32(arg0 + 4 * 0, ptr1, true);\n    };\n    imports.wbg.__wbg_set_bb8cecf6a62b9f46 = function() { return handleError(function (arg0, arg1, arg2) {\n        const ret = Reflect.set(arg0, arg1, arg2);\n        return ret;\n    }, arguments) };\n    imports.wbg.__wbg_static_accessor_GLOBAL_88a902d13a557d07 = function() {\n        const ret = typeof global === 'undefined' ? null : global;\n        return isLikeNone(ret) ? 0 : addToExternrefTable0(ret);\n    };\n    imports.wbg.__wbg_static_accessor_GLOBAL_THIS_56578be7e9f832b0 = function() {\n        const ret = typeof globalThis === 'undefined' ? null : globalThis;\n        return isLikeNone(ret) ? 0 : addToExternrefTable0(ret);\n    };\n    imports.wbg.__wbg_static_accessor_SELF_37c5d418e4bf5819 = function() {\n        const ret = typeof self === 'undefined' ? null : self;\n        return isLikeNone(ret) ? 0 : addToExternrefTable0(ret);\n    };\n    imports.wbg.__wbg_static_accessor_WINDOW_5de37043a91a9c40 = function() {\n        const ret = typeof window === 'undefined' ? null : window;\n        return isLikeNone(ret) ? 0 : addToExternrefTable0(ret);\n    };\n    imports.wbg.__wbg_toString_5285597960676b7b = function(arg0) {\n        const ret = arg0.toString();\n        return ret;\n    };\n    imports.wbg.__wbg_toString_c813bbd34d063839 = function(arg0) {\n        const ret = arg0.toString();\n        return ret;\n    };\n    imports.wbg.__wbindgen_boolean_get = function(arg0) {\n        const v = arg0;\n        const ret = typeof(v) === 'boolean' ? (v ? 1 : 0) : 2;\n        return ret;\n    };\n    imports.wbg.__wbindgen_error_new = function(arg0, arg1) {\n        const ret = new Error(getStringFromWasm0(arg0, arg1));\n        return ret;\n    };\n    imports.wbg.__wbindgen_init_externref_table = function() {\n        const table = wasm.__wbindgen_export_2;\n        const offset = table.grow(4);\n        table.set(0, undefined);\n        table.set(offset + 0, undefined);\n        table.set(offset + 1, null);\n        table.set(offset + 2, true);\n        table.set(offset + 3, false);\n        ;\n    };\n    imports.wbg.__wbindgen_is_function = function(arg0) {\n        const ret = typeof(arg0) === 'function';\n        return ret;\n    };\n    imports.wbg.__wbindgen_is_undefined = function(arg0) {\n        const ret = arg0 === undefined;\n        return ret;\n    };\n    imports.wbg.__wbindgen_memory = function() {\n        const ret = wasm.memory;\n        return ret;\n    };\n    imports.wbg.__wbindgen_number_new = function(arg0) {\n        const ret = arg0;\n        return ret;\n    };\n    imports.wbg.__wbindgen_string_get = function(arg0, arg1) {\n        const obj = arg1;\n        const ret = typeof(obj) === 'string' ? obj : undefined;\n        var ptr1 = isLikeNone(ret) ? 0 : passStringToWasm0(ret, wasm.__wbindgen_malloc, wasm.__wbindgen_realloc);\n        var len1 = WASM_VECTOR_LEN;\n        getDataViewMemory0().setInt32(arg0 + 4 * 1, len1, true);\n        getDataViewMemory0().setInt32(arg0 + 4 * 0, ptr1, true);\n    };\n    imports.wbg.__wbindgen_string_new = function(arg0, arg1) {\n        const ret = getStringFromWasm0(arg0, arg1);\n        return ret;\n    };\n    imports.wbg.__wbindgen_throw = function(arg0, arg1) {\n        throw new Error(getStringFromWasm0(arg0, arg1));\n    };\n\n    return imports;\n}\n\nfunction __wbg_init_memory(imports, memory) {\n    imports.wbg.memory = memory || new WebAssembly.Memory({initial:18,maximum:16384,shared:true});\n}\n\nfunction __wbg_finalize_init(instance, module, thread_stack_size) {\n    wasm = instance.exports;\n    __wbg_init.__wbindgen_wasm_module = module;\n    cachedDataViewMemory0 = null;\n    cachedUint8ArrayMemory0 = null;\n\n    if (typeof thread_stack_size !== 'undefined' && (typeof thread_stack_size !== 'number' || thread_stack_size === 0 || thread_stack_size % 65536 !== 0)) { throw 'invalid stack size' }\n    wasm.__wbindgen_start(thread_stack_size);\n    return wasm;\n}\n\nfunction initSync(module, memory) {\n    if (wasm !== undefined) return wasm;\n\n    let thread_stack_size\n    if (typeof module !== 'undefined') {\n        if (Object.getPrototypeOf(module) === Object.prototype) {\n            ({module, memory, thread_stack_size} = module)\n        } else {\n            console.warn('using deprecated parameters for `initSync()`; pass a single object instead')\n        }\n    }\n\n    const imports = __wbg_get_imports();\n\n    __wbg_init_memory(imports, memory);\n\n    if (!(module instanceof WebAssembly.Module)) {\n        module = new WebAssembly.Module(module);\n    }\n\n    const instance = new WebAssembly.Instance(module, imports);\n\n    return __wbg_finalize_init(instance, module, thread_stack_size);\n}\n\nasync function __wbg_init(module_or_path, memory) {\n    if (wasm !== undefined) return wasm;\n\n    let thread_stack_size\n    if (typeof module_or_path !== 'undefined') {\n        if (Object.getPrototypeOf(module_or_path) === Object.prototype) {\n            ({module_or_path, memory, thread_stack_size} = module_or_path)\n        } else {\n            console.warn('using deprecated parameters for the initialization function; pass a single object instead')\n        }\n    }\n\n    if (typeof module_or_path === 'undefined') {\n        module_or_path = new URL('wasm_bg.wasm', \"\");\n    }\n    const imports = __wbg_get_imports();\n\n    if (typeof module_or_path === 'string' || (typeof Request === 'function' && module_or_path instanceof Request) || (typeof URL === 'function' && module_or_path instanceof URL)) {\n        module_or_path = fetch(module_or_path);\n    }\n\n    __wbg_init_memory(imports, memory);\n\n    const { instance, module } = await __wbg_load(await module_or_path, imports);\n\n    return __wbg_finalize_init(instance, module, thread_stack_size);\n}\n\nexport { initSync };\nexport default __wbg_init;\n","import { FakeServiceWorker } from \"./fakesw\";\nimport { handleFetch } from \"./fetch\";\nimport type BareClient from \"@mercuryworkshop/bare-mux\";\nimport { ScramjetConfig } from \"../types\";\nimport { $scramjet, loadCodecs } from \"../scramjet\";\nimport { asyncInitRewriter } from \"../shared/rewriters/js\";\n\nexport class ScramjetServiceWorker extends EventTarget {\n\tclient: BareClient;\n\tconfig: ScramjetConfig;\n\n\tsyncPool: Record<number, (val?: any) => void> = {};\n\tsynctoken = 0;\n\n\tcookieStore = new $scramjet.shared.CookieStore();\n\n\tserviceWorkers: FakeServiceWorker[] = [];\n\n\tconstructor() {\n\t\tsuper();\n\t\tthis.client = new $scramjet.shared.util.BareClient();\n\n\t\tconst db = indexedDB.open(\"$scramjet\", 1);\n\n\t\tdb.onsuccess = () => {\n\t\t\tconst res = db.result;\n\t\t\tconst tx = res.transaction(\"cookies\", \"readonly\");\n\t\t\tconst store = tx.objectStore(\"cookies\");\n\t\t\tconst cookies = store.get(\"cookies\");\n\n\t\t\tcookies.onsuccess = () => {\n\t\t\t\tif (cookies.result) {\n\t\t\t\t\tthis.cookieStore.load(cookies.result);\n\t\t\t\t}\n\t\t\t};\n\t\t};\n\n\t\taddEventListener(\"message\", async ({ data }: { data: MessageC2W }) => {\n\t\t\tif (!(\"scramjet$type\" in data)) return;\n\n\t\t\tif (\"scramjet$token\" in data) {\n\t\t\t\t// (ack message)\n\t\t\t\tconst cb = this.syncPool[data.scramjet$token];\n\t\t\t\tdelete this.syncPool[data.scramjet$token];\n\t\t\t\tcb(data);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (data.scramjet$type === \"registerServiceWorker\") {\n\t\t\t\tthis.serviceWorkers.push(new FakeServiceWorker(data.port, data.origin));\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (data.scramjet$type === \"cookie\") {\n\t\t\t\tthis.cookieStore.setCookies([data.cookie], new URL(data.url));\n\t\t\t\tconst res = db.result;\n\t\t\t\tconst tx = res.transaction(\"cookies\", \"readwrite\");\n\t\t\t\tconst store = tx.objectStore(\"cookies\");\n\t\t\t\tstore.put(JSON.parse(this.cookieStore.dump()), \"cookies\");\n\t\t\t}\n\n\t\t\tif (data.scramjet$type === \"loadConfig\") {\n\t\t\t\tthis.config = data.config;\n\t\t\t}\n\t\t});\n\t}\n\n\tasync dispatch(client: Client, data: MessageW2C): Promise<MessageC2W> {\n\t\tconst token = this.synctoken++;\n\t\tlet cb: (val: MessageC2W) => void;\n\t\tconst promise: Promise<MessageC2W> = new Promise((r) => (cb = r));\n\t\tthis.syncPool[token] = cb;\n\t\tdata.scramjet$token = token;\n\n\t\tclient.postMessage(data);\n\n\t\treturn await promise;\n\t}\n\n\tasync loadConfig() {\n\t\tif (this.config) return;\n\n\t\tconst request = indexedDB.open(\"$scramjet\", 1);\n\n\t\treturn new Promise<void>((resolve, reject) => {\n\t\t\trequest.onsuccess = async () => {\n\t\t\t\tconst db = request.result;\n\t\t\t\tconst tx = db.transaction(\"config\", \"readonly\");\n\t\t\t\tconst store = tx.objectStore(\"config\");\n\t\t\t\tconst config = store.get(\"config\");\n\n\t\t\t\tconfig.onsuccess = async () => {\n\t\t\t\t\tthis.config = config.result;\n\t\t\t\t\t$scramjet.config = config.result;\n\n\t\t\t\t\tloadCodecs();\n\n\t\t\t\t\tawait asyncInitRewriter();\n\n\t\t\t\t\tresolve();\n\t\t\t\t};\n\t\t\t\tconfig.onerror = () => reject(config.error);\n\t\t\t};\n\n\t\t\trequest.onerror = () => reject(request.error);\n\t\t});\n\t}\n\n\troute({ request }: FetchEvent) {\n\t\tif (request.url.startsWith(location.origin + this.config.prefix))\n\t\t\treturn true;\n\t\telse if (request.url.startsWith(location.origin + this.config.files.wasm))\n\t\t\treturn true;\n\t\telse return false;\n\t}\n\n\tasync fetch({ request, clientId }: FetchEvent) {\n\t\tif (!this.config) await this.loadConfig();\n\n\t\tconst client = await self.clients.get(clientId);\n\n\t\treturn handleFetch.call(this, request, client);\n\t}\n}\n\n// @ts-ignore\nself.ScramjetServiceWorker = ScramjetServiceWorker;\n\ntype RegisterServiceWorkerMessage = {\n\tscramjet$type: \"registerServiceWorker\";\n\tport: MessagePort;\n\torigin: string;\n};\n\ntype CookieMessage = {\n\tscramjet$type: \"cookie\";\n\tcookie: string;\n\turl: string;\n};\n\ntype ConfigMessage = {\n\tscramjet$type: \"loadConfig\";\n\tconfig: ScramjetConfig;\n};\n\ntype MessageCommon = {\n\tscramjet$type: string;\n\tscramjet$token?: number;\n};\n\ntype MessageTypeC2W =\n\t| RegisterServiceWorkerMessage\n\t| CookieMessage\n\t| ConfigMessage;\ntype MessageTypeW2C = CookieMessage;\n\n// c2w: client to (service) worker\nexport type MessageC2W = MessageCommon & MessageTypeC2W;\nexport type MessageW2C = MessageCommon & MessageTypeW2C;\n"],"names":["self","COMMITHASH","VERSION","flagEnabled","$scramjet","nativeFunction","Function","loadCodecs","flag","url","value","regex","partialflags","RegExp","BareClient","ScramjetHeaders","BareMuxConnection","rewriteUrl","unrewriteUrl","rewriteBlob","unrewriteBlob","rewriteCss","unrewriteCss","rewriteHtml","unrewriteHtml","rewriteSrcset","rewriteJs","rewriteHeaders","rewriteWorkers","htmlRules","CookieStore","asyncInitRewriter","buf","fetch","r","Uint8Array","atob","c","Error","decoder","TextDecoder","rewriteJsWithMap","js","meta","module","rewriteJsInner","rewriteJsWasm","input","source","out","initSync","WebAssembly","before","performance","rewrite_js","rewrite_js_from_arraybuffer","err","console","err1","after","map","scramtag","errors","duration","globalThis","Array","error","timespan","overhead","Number","renderError","fetchedURL","headers","crossOriginIsolated","Response","errorTemplate","trace","script","JSON","location","encodeURIComponent","String","FakeServiceWorker","handle","origin","MessageChannel","event","data","cb","request","token","message","transfer","Promise","resolve","newmeta","handleFetch","client","requesturl","URL","workertype","x","b64","btoa","byte","payload","body","dataurl","response","rewriteBody","Object","activeWorker","w","key","clientURL","cookies","ev","ScramjetRequestEvent","handleResponse","errorDetails","Date","undefined","formattedError","destination","cookieStore","swtarget","responseBody","responseHeaders","maybeHeaders","cookie","promise","header","type","filename","ScramjetHandleResponseEvent","tag","sourcemapfn","strictMode","Event","status","statusText","rawResponse","requestHeaders","method","crypto","wasm","addToExternrefTable0","obj","idx","handleError","f","args","e","cachedTextDecoder","cachedUint8ArrayMemory0","getUint8ArrayMemory0","getStringFromWasm0","ptr","len","WASM_VECTOR_LEN","cachedTextEncoder","TextEncoder","encodeString","arg","view","passStringToWasm0","malloc","realloc","mem","offset","code","ret","cachedDataViewMemory0","getDataViewMemory0","DataView","isLikeNone","takeFromExternrefTable0","script_url","scramjet","ptr0","len0","ptr1","len1","ptr2","len2","passArray8ToWasm0","__wbg_load","imports","bytes","instance","__wbg_get_imports","arg0","arg1","arguments","arg2","arg3","Reflect","global","window","v","table","__wbg_init_memory","memory","__wbg_finalize_init","thread_stack_size","__wbg_init","module_or_path","Request","ScramjetServiceWorker","EventTarget","db","indexedDB","store","tx","res","addEventListener","reject","config","clientId"],"mappings":"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"}